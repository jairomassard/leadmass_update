"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[465],{8465:function(a,o,r){r.r(o),r.d(o,{default:function(){return M}});var s=r(6768),i=r(4232),e=r(5130);const l={id:"admin-usuarios",class:"container mt-5"},t={class:"card mb-4 shadow-sm"},u={class:"card-body"},n={class:"card-title text-center"},c={class:"row mb-3"},d={class:"col-md-6"},m={class:"col-md-6"},v={class:"row mb-3"},p={class:"col-md-4"},b={class:"col-md-4"},k={class:"col-md-4"},L={key:0,class:"row mb-3"},h={class:"col-md-12"},f=["value"],A={class:"row mb-3"},_={class:"col-md-6"},g={class:"col-md-6"},C={class:"row mb-3"},U={class:"col-md-6"},E={class:"col-md-6"},y=["required"],w=["value"],x={type:"submit",class:"btn btn-primary w-100"},V={key:1,class:"text-center mt-3"},X={class:"text-center mb-4"},N={key:0,class:"table-responsive"},q={class:"table table-striped table-hover"},I=["onClick"],D=["onClick"],J=["onClick"];function S(a,o,r,S,z,F){return(0,s.uX)(),(0,s.CE)("div",l,[o[29]||(o[29]=(0,s.Lk)("h1",{class:"text-center mb-4"},"Administración de Usuarios",-1)),(0,s.Lk)("div",t,[(0,s.Lk)("div",u,[(0,s.Lk)("h3",n,(0,i.v_)(z.usuarioActual.id?"Editar Usuario":"Crear Nuevo Usuario"),1),(0,s.Lk)("form",{onSubmit:o[12]||(o[12]=(0,e.D$)(((...a)=>F.guardarUsuario&&F.guardarUsuario(...a)),["prevent"]))},[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[o[14]||(o[14]=(0,s.Lk)("label",{for:"nombres",class:"form-label"},"Nombres:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>z.usuarioActual.nombres=a),class:"form-control",required:""},null,512),[[e.Jo,z.usuarioActual.nombres]])]),(0,s.Lk)("div",m,[o[15]||(o[15]=(0,s.Lk)("label",{for:"apellidos",class:"form-label"},"Apellidos:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=a=>z.usuarioActual.apellidos=a),class:"form-control",required:""},null,512),[[e.Jo,z.usuarioActual.apellidos]])])]),(0,s.Lk)("div",v,[(0,s.Lk)("div",p,[o[16]||(o[16]=(0,s.Lk)("label",{for:"usuario",class:"form-label"},"Usuario:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=a=>z.usuarioActual.usuario=a),class:"form-control",required:""},null,512),[[e.Jo,z.usuarioActual.usuario]])]),(0,s.Lk)("div",b,[o[17]||(o[17]=(0,s.Lk)("label",{for:"password",class:"form-label"},"Contraseña:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password","onUpdate:modelValue":o[3]||(o[3]=a=>z.usuarioActual.password=a),class:"form-control",required:""},null,512),[[e.Jo,z.usuarioActual.password]])]),(0,s.Lk)("div",k,[o[19]||(o[19]=(0,s.Lk)("label",{for:"tipo_usuario",class:"form-label"},"Tipo de Usuario:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":o[4]||(o[4]=a=>z.usuarioActual.tipo_usuario=a),onChange:o[5]||(o[5]=(...a)=>F.validarRol&&F.validarRol(...a)),class:"form-select"},o[18]||(o[18]=[(0,s.Fv)('<option value="vendedor" data-v-5f888128>Vendedor</option><option value="supervisor" data-v-5f888128>Supervisor</option><option value="administrador" data-v-5f888128>Administrador</option><option value="expert" data-v-5f888128>Expert</option><option value="gerente" data-v-5f888128>Gerente</option>',5)]),544),[[e.u1,z.usuarioActual.tipo_usuario]])])]),"gerente"===z.usuarioActual.tipo_usuario||"supervisor"===z.usuarioActual.tipo_usuario?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("div",h,[o[21]||(o[21]=(0,s.Lk)("label",{for:"marca_asignada",class:"form-label"},"Marca Asignada:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":o[6]||(o[6]=a=>z.usuarioActual.marca_asignada=a),class:"form-select",required:""},[o[20]||(o[20]=(0,s.Lk)("option",{value:"",disabled:""},"Seleccione una marca",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(z.marcasDisponibles,(a=>((0,s.uX)(),(0,s.CE)("option",{key:a,value:a},(0,i.v_)(a),9,f)))),128))],512),[[e.u1,z.usuarioActual.marca_asignada]])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",A,[(0,s.Lk)("div",_,[o[22]||(o[22]=(0,s.Lk)("label",{for:"celular",class:"form-label"},"Celular:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[7]||(o[7]=a=>z.usuarioActual.celular=a),class:"form-control"},null,512),[[e.Jo,z.usuarioActual.celular]])]),(0,s.Lk)("div",g,[o[23]||(o[23]=(0,s.Lk)("label",{for:"correo",class:"form-label"},"Correo Electrónico:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":o[8]||(o[8]=a=>z.usuarioActual.correo=a),class:"form-control"},null,512),[[e.Jo,z.usuarioActual.correo]])])]),(0,s.Lk)("div",C,[(0,s.Lk)("div",U,[o[25]||(o[25]=(0,s.Lk)("label",{for:"activo",class:"form-label"},"Estado:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":o[9]||(o[9]=a=>z.usuarioActual.activo=a),class:"form-select"},o[24]||(o[24]=[(0,s.Lk)("option",{value:!0},"Activo",-1),(0,s.Lk)("option",{value:!1},"Inactivo",-1)]),512),[[e.u1,z.usuarioActual.activo]])]),(0,s.Lk)("div",E,[o[27]||(o[27]=(0,s.Lk)("label",{for:"concesionario",class:"form-label"},"Concesionario:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":o[10]||(o[10]=a=>z.usuarioActual.concesionario=a),class:"form-select",required:"vendedor"===z.usuarioActual.tipo_usuario},[o[26]||(o[26]=(0,s.Lk)("option",{value:"",disabled:""},"Seleccione un concesionario",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(z.concesionarios,(a=>((0,s.uX)(),(0,s.CE)("option",{key:a.id,value:a.nombre_concesionario},(0,i.v_)(a.nombre_concesionario)+" - "+(0,i.v_)(a.ciudad),9,w)))),128))],8,y),[[e.u1,z.usuarioActual.concesionario]])])]),(0,s.Lk)("button",x,(0,i.v_)(z.usuarioActual.id?"Actualizar":"Crear")+" Usuario",1),z.usuarioActual.id?((0,s.uX)(),(0,s.CE)("div",V,[(0,s.Lk)("button",{type:"button",class:"btn btn-warning",onClick:o[11]||(o[11]=(...a)=>F.cancelarEdicion&&F.cancelarEdicion(...a))},"Cancelar")])):(0,s.Q3)("",!0)],32)])]),(0,s.Lk)("div",X,[(0,s.Lk)("button",{class:"btn btn-secondary",onClick:o[13]||(o[13]=(...a)=>F.consultarUsuarios&&F.consultarUsuarios(...a))},"Revisión Usuarios Creados")]),o[30]||(o[30]=(0,s.Lk)("h2",{class:"text-center mb-3"},"Lista de Usuarios",-1)),z.usuarios.length?((0,s.uX)(),(0,s.CE)("div",N,[(0,s.Lk)("table",q,[o[28]||(o[28]=(0,s.Lk)("thead",{class:"table-dark"},[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"ID"),(0,s.Lk)("th",null,"Usuario"),(0,s.Lk)("th",null,"Nombres"),(0,s.Lk)("th",null,"Apellidos"),(0,s.Lk)("th",null,"Celular"),(0,s.Lk)("th",null,"Correo"),(0,s.Lk)("th",null,"Tipo"),(0,s.Lk)("th",null,"Concesionario"),(0,s.Lk)("th",null,"Fecha de Creación"),(0,s.Lk)("th",null,"Estado"),(0,s.Lk)("th",null,"Acciones")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(z.usuarios,(a=>((0,s.uX)(),(0,s.CE)("tr",{key:a.id},[(0,s.Lk)("td",null,(0,i.v_)(a.id),1),(0,s.Lk)("td",null,(0,i.v_)(a.usuario),1),(0,s.Lk)("td",null,(0,i.v_)(a.nombres),1),(0,s.Lk)("td",null,(0,i.v_)(a.apellidos),1),(0,s.Lk)("td",null,(0,i.v_)(a.celular),1),(0,s.Lk)("td",null,(0,i.v_)(a.correo),1),(0,s.Lk)("td",null,(0,i.v_)(a.tipo_usuario),1),(0,s.Lk)("td",null,(0,i.v_)(a.concesionario),1),(0,s.Lk)("td",null,(0,i.v_)(a.fecha_creacion),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,i.C4)(a.activo?"badge bg-success":"badge bg-danger")},(0,i.v_)(a.activo?"Activo":"Inactivo"),3)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-sm btn-info me-2",onClick:o=>F.editarUsuario(a)},"Editar",8,I),(0,s.Lk)("button",{class:"btn btn-sm btn-danger me-2",onClick:o=>F.eliminarUsuario(a)},"Eliminar",8,D),(0,s.Lk)("button",{class:(0,i.C4)(["btn btn-sm",a.activo?"btn-danger":"btn-success"]),onClick:o=>F.toggleEstado(a)},(0,i.v_)(a.activo?"Desactivar":"Activar"),11,J)])])))),128))])])])):(0,s.Q3)("",!0)])}r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(8992),r(4520),r(670),r(1454);var z=r(3173),F={data(){return{usuarios:[],usuarioActual:{id:null,usuario:"",password:"",nombres:"",apellidos:"",concesionario:"",tipo_usuario:"vendedor",marca_asignada:"",activo:!0,celular:"",correo:""},concesionarios:[],marcasDisponibles:[]}},methods:{consultarConcesionarios(){return z.A.get("/get-concesionarios").then((a=>{console.log("✅ Concesionarios cargados:",a.data),this.concesionarios=a.data,this.marcasDisponibles=[...new Set(a.data.flatMap((a=>a.marcas)))]})).catch((a=>console.error("Error al obtener concesionarios:",a)))},consultarUsuarios(){return z.A.get("/get-usuarios").then((a=>{this.usuarios=(a.data||[]).map(this.normalizeUsuario)})).catch((a=>console.error("Error al obtener usuarios:",a)))},guardarUsuario(){if("vendedor"===this.usuarioActual.tipo_usuario&&!this.usuarioActual.concesionario)return void alert("El vendedor debe tener un concesionario asignado.");const a=this.usuarioActual.id?"/update-usuario":"/add-usuario";z.A.post(a,this.usuarioActual).then((()=>{alert("Usuario guardado o actualizado exitosamente"),this.consultarUsuarios(),this.cancelarEdicion()})).catch((a=>console.error("Error al guardar el usuario:",a)))},editarUsuario(a){const o=this.normalizeUsuario(a),r=Array.isArray(a.concesionario)?a.concesionario[0]||"":a.concesionario||"";this.usuarioActual={...o,concesionario:"N/A"===r?"":r}},cancelarEdicion(){this.usuarioActual={id:null,usuario:"",password:"",nombres:"",apellidos:"",concesionario:"",tipo_usuario:"vendedor",marca_asignada:"",activo:!0,celular:"",correo:""}},eliminarUsuario(a){confirm(`⚠️ ¿Estás seguro de que deseas eliminar al usuario ${a.usuario}?`)&&confirm("Esta acción es irreversible. Confirma nuevamente para eliminar.")&&z.A.post("/delete-usuario",{id:a.id}).then((()=>{alert("Usuario eliminado exitosamente"),this.consultarUsuarios()})).catch((a=>console.error("❌ Error al eliminar usuario:",a)))},normalizeUsuario(a){return{...a,concesionario:Array.isArray(a.concesionario)?a.concesionario.filter(Boolean).join(", ")||"N/A":a.concesionario||"N/A",fecha_creacion:a.fecha_creacion?new Date(a.fecha_creacion).toLocaleString("es-CO"):"N/A",celular:a.celular||"N/A",correo:a.correo||"N/A",activo:!0===a.activo||"true"===a.activo||1===a.activo,marca_asignada:a.marca_asignada||""}},toggleEstado(a){a.activo=!a.activo,z.A.post("/update-usuario",a).then((()=>this.consultarUsuarios())).catch((a=>console.error("Error al cambiar estado:",a)))},validarRol(){"gerente"!==this.usuarioActual.tipo_usuario&&"supervisor"!==this.usuarioActual.tipo_usuario&&(this.usuarioActual.marca_asignada="")}},async created(){await this.consultarConcesionarios()}},R=r(1241);const K=(0,R.A)(F,[["render",S],["__scopeId","data-v-5f888128"]]);var M=K},8646:function(a,o,r){var s=r(9565),i=r(8551),e=r(1767),l=r(851);a.exports=function(a,o){o&&"string"===typeof a||i(a);var r=l(a);return e(i(void 0!==r?s(r,a):a))}},670:function(a,o,r){var s=r(6518),i=r(9565),e=r(9306),l=r(8551),t=r(1767),u=r(8646),n=r(9462),c=r(9539),d=r(6395),m=n((function(){var a,o,r=this.iterator,s=this.mapper;while(1){if(o=this.inner)try{if(a=l(i(o.next,o.iterator)),!a.done)return a.value;this.inner=null}catch(e){c(r,"throw",e)}if(a=l(i(this.next,r)),this.done=!!a.done)return;try{this.inner=u(s(a.value,this.counter++),!1)}catch(e){c(r,"throw",e)}}}));s({target:"Iterator",proto:!0,real:!0,forced:d},{flatMap:function(a){return l(this),e(a),new m(t(this),{mapper:a,inner:null})}})}}]);
//# sourceMappingURL=465.d0fc41c4.js.map