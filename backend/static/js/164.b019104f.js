"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[164],{6164:function(e,a,l){l.r(a),l.d(a,{default:function(){return ie}});var o=l(6768),t=l(4232),d=l(5130);const s={id:"app",class:"container mt-5"},i={key:0,class:"row text-center mb-4"},n={class:"col-md-6"},r={class:"card p-3"},c={class:"display-6"},u={class:"col-md-6"},b={class:"card p-3"},m={class:"display-6"},L={class:"text-center mb-4"},h={key:1,class:"d-flex justify-content-center align-items-center mb-4"},v={class:"position-indicator mx-3 text-nowrap"},k={key:2,class:"card p-4 mb-4"},p={class:"row"},A={class:"col-md-6 mb-3"},f=["disabled"],g={class:"col-md-6 mb-3"},_=["disabled"],C={class:"col-md-6 mb-3"},M=["disabled"],y={class:"col-md-6 mb-3"},E=["disabled"],x={class:"col-md-6 mb-3"},S=["disabled"],I={class:"col-md-6 mb-3"},V=["disabled"],D={class:"col-md-6 mb-3"},U=["disabled"],N={class:"col-md-6 mb-3"},w=["disabled"],J={class:"col-md-6 mb-3"},$=["disabled"],T={class:"col-md-6 mb-3"},P=["disabled"],z={class:"col-md-6 mb-3"},X=["disabled"],Q={class:"col-md-6 mb-3"},F=["disabled"],q={key:0,class:"col-md-3 mb-3"},G=["disabled"],O={class:"col-md-3 mb-3"},R=["disabled"],j={class:"col-md-3 mb-3"},B=["disabled"],H={class:"col-md-3 mb-3"},K=["disabled"],W={class:"text-center mt-3"},Y={class:"text-center mb-4"},Z={class:"card p-4 mb-4"},ee={class:"text-center mb-4"};function ae(e,a,l,ae,le,oe){const te=(0,o.g2)("BotonesGlobales");return(0,o.uX)(),(0,o.CE)("div",s,[a[50]||(a[50]=(0,o.Lk)("h1",{class:"text-center mb-4"},"Cargue y Gestión de Leads",-1)),null!==le.totalLeads?((0,o.uX)(),(0,o.CE)("div",i,[(0,o.Lk)("div",n,[(0,o.Lk)("div",r,[a[25]||(a[25]=(0,o.Lk)("h5",null,"Total Leads",-1)),(0,o.Lk)("p",c,(0,t.v_)(le.totalLeads),1)])]),(0,o.Lk)("div",u,[(0,o.Lk)("div",b,[a[26]||(a[26]=(0,o.Lk)("h5",null,"Total Leads Nuevos Sin Asignar",-1)),(0,o.Lk)("p",m,(0,t.v_)(le.totalLeadsNuevosSinAsignar),1)])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",L,[(0,o.Lk)("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=(...e)=>oe.consultarLeads&&oe.consultarLeads(...e))},"Consultar Leads")]),le.leadActual?((0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>oe.leadAnterior&&oe.leadAnterior(...e)),class:"btn btn-outline-secondary me-3"},"← Anterior"),(0,o.Lk)("span",v,(0,t.v_)(le.currentIndex+1)+" de "+(0,t.v_)(le.leads.length),1),(0,o.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>oe.leadSiguiente&&oe.leadSiguiente(...e)),class:"btn btn-outline-secondary ms-3"},"Siguiente →")])):(0,o.Q3)("",!0),le.leadActual?((0,o.uX)(),(0,o.CE)("div",k,[a[47]||(a[47]=(0,o.Lk)("h4",null,"Información del Lead",-1)),(0,o.Lk)("div",p,[(0,o.Lk)("div",A,[a[27]||(a[27]=(0,o.Lk)("label",null,"Nombres",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>le.leadActual.nombres=e),disabled:!le.editMode,class:"form-control"},null,8,f),[[d.Jo,le.leadActual.nombres]])]),(0,o.Lk)("div",g,[a[28]||(a[28]=(0,o.Lk)("label",null,"Apellidos",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>le.leadActual.apellidos=e),disabled:!le.editMode,class:"form-control"},null,8,_),[[d.Jo,le.leadActual.apellidos]])]),(0,o.Lk)("div",C,[a[29]||(a[29]=(0,o.Lk)("label",null,"Identificación",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>le.leadActual.identificacion=e),disabled:!le.editMode,class:"form-control"},null,8,M),[[d.Jo,le.leadActual.identificacion]])]),(0,o.Lk)("div",y,[a[30]||(a[30]=(0,o.Lk)("label",null,"Teléfono",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>le.leadActual.telefono=e),disabled:!le.editMode,class:"form-control"},null,8,E),[[d.Jo,le.leadActual.telefono]])]),(0,o.Lk)("div",x,[a[31]||(a[31]=(0,o.Lk)("label",null,"Dirección",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>le.leadActual.direccion=e),disabled:!le.editMode,class:"form-control"},null,8,S),[[d.Jo,le.leadActual.direccion]])]),(0,o.Lk)("div",I,[a[32]||(a[32]=(0,o.Lk)("label",null,"Ciudad",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>le.leadActual.ciudad=e),disabled:!le.editMode,class:"form-control"},null,8,V),[[d.Jo,le.leadActual.ciudad]])]),(0,o.Lk)("div",D,[a[33]||(a[33]=(0,o.Lk)("label",null,"Correo",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[9]||(a[9]=e=>le.leadActual.correo=e),disabled:!le.editMode,class:"form-control"},null,8,U),[[d.Jo,le.leadActual.correo]])]),(0,o.Lk)("div",N,[a[34]||(a[34]=(0,o.Lk)("label",null,"Fecha Lead",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[10]||(a[10]=e=>le.leadActual.fecha_lead=e),disabled:!le.editMode,class:"form-control"},null,8,w),[[d.Jo,le.leadActual.fecha_lead]])]),(0,o.Lk)("div",J,[a[35]||(a[35]=(0,o.Lk)("label",null,"Origen Lead",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[11]||(a[11]=e=>le.leadActual.origen_lead=e),disabled:!le.editMode,class:"form-control"},null,8,$),[[d.Jo,le.leadActual.origen_lead]])]),(0,o.Lk)("div",T,[a[36]||(a[36]=(0,o.Lk)("label",null,"Marca de Interés",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[12]||(a[12]=e=>le.leadActual.marca_interes=e),disabled:!le.editMode,class:"form-control"},null,8,P),[[d.Jo,le.leadActual.marca_interes]])]),(0,o.Lk)("div",z,[a[37]||(a[37]=(0,o.Lk)("label",null,"Modelo Interesado",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[13]||(a[13]=e=>le.leadActual.modelo_interesado=e),disabled:!le.editMode,class:"form-control"},null,8,X),[[d.Jo,le.leadActual.modelo_interesado]])]),(0,o.Lk)("div",Q,[a[38]||(a[38]=(0,o.Lk)("label",null,"Estatus",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":a[14]||(a[14]=e=>le.leadActual.estatus=e),disabled:!le.editMode,class:"form-control"},null,8,F),[[d.Jo,le.leadActual.estatus]])]),le.editMode||le.leadActual?((0,o.uX)(),(0,o.CE)("div",q,[a[40]||(a[40]=(0,o.Lk)("label",null,"Asignado",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":a[15]||(a[15]=e=>le.leadActual.asignado=e),disabled:!le.editMode,class:"form-select"},a[39]||(a[39]=[(0,o.Lk)("option",{value:!0},"True",-1),(0,o.Lk)("option",{value:!1},"False",-1)]),8,G),[[d.u1,le.leadActual.asignado]])])):(0,o.Q3)("",!0),(0,o.Lk)("div",O,[a[42]||(a[42]=(0,o.Lk)("label",null,"Test Drive",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":a[16]||(a[16]=e=>le.leadActual.test_drive=e),disabled:!le.editMode,class:"form-select"},a[41]||(a[41]=[(0,o.Lk)("option",{value:"No"},"No",-1),(0,o.Lk)("option",{value:"Si"},"Si",-1)]),8,R),[[d.u1,le.leadActual.test_drive]])]),(0,o.Lk)("div",j,[a[44]||(a[44]=(0,o.Lk)("label",null,"Habeas Data",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":a[17]||(a[17]=e=>le.leadActual.habeas_data=e),disabled:!le.editMode,class:"form-select",required:""},a[43]||(a[43]=[(0,o.Lk)("option",{value:"Si"},"Si",-1),(0,o.Lk)("option",{value:"No"},"No",-1)]),8,B),[[d.u1,le.leadActual.habeas_data]])]),(0,o.Lk)("div",H,[a[46]||(a[46]=(0,o.Lk)("label",null,"Tratamiento de Datos",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":a[18]||(a[18]=e=>le.leadActual.aceptacion_tratamiento_datos=e),disabled:!le.editMode,class:"form-select",required:""},a[45]||(a[45]=[(0,o.Lk)("option",{value:"Si"},"Si",-1),(0,o.Lk)("option",{value:"No"},"No",-1)]),8,K),[[d.u1,le.leadActual.aceptacion_tratamiento_datos]])])]),(0,o.Lk)("div",W,[le.editMode?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"btn btn-warning",onClick:a[19]||(a[19]=(...e)=>oe.habilitarEdicion&&oe.habilitarEdicion(...e))},"Editar")),le.editMode?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"btn btn-success",onClick:a[20]||(a[20]=(...e)=>oe.guardarCambios&&oe.guardarCambios(...e))},"Guardar")):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",Y,[(0,o.Lk)("button",{class:"btn btn-secondary",onClick:a[21]||(a[21]=(...e)=>oe.nuevoLead&&oe.nuevoLead(...e))},"Nuevo Lead")]),(0,o.Lk)("div",Z,[a[48]||(a[48]=(0,o.Lk)("h4",null,"Cargar Leads desde archivo",-1)),(0,o.Lk)("input",{type:"file",class:"form-control mb-3",onChange:a[22]||(a[22]=(...e)=>oe.seleccionarArchivo&&oe.seleccionarArchivo(...e))},null,32),(0,o.Lk)("button",{class:"btn btn-primary",onClick:a[23]||(a[23]=(...e)=>oe.cargarLeadsDesdeArchivo&&oe.cargarLeadsDesdeArchivo(...e))},"Cargar desde archivo")]),(0,o.Lk)("div",ee,[(0,o.Lk)("button",{class:"btn btn-info",onClick:a[24]||(a[24]=(...e)=>oe.descargarPlantilla&&oe.descargarPlantilla(...e))},"Descargar Archivo Plantilla Modelo"),a[49]||(a[49]=(0,o.Lk)("p",{class:"mt-2"},"Descargar y modificar contenido del archivo modelo. Seguir la estructura y no cambiar el orden de las columnas.",-1))]),(0,o.bF)(te)])}l(4114),l(8992),l(4520),l(1454);var le=l(3173),oe=l(6743),te={name:"LeadsComponent",data(){return{leads:[],currentIndex:0,leadActual:null,editMode:!1,archivo:null,totalLeads:null,totalLeadsNuevosSinAsignar:null}},methods:{consultarLeads(){le.A.get("/get-leads").then((e=>{this.leads=e.data,this.leadActual=this.leads[this.currentIndex],this.totalLeads=this.leads.length,this.totalLeadsNuevosSinAsignar=this.leads.filter((e=>"nuevo"===e.estatus&&!e.asignado)).length})).catch((e=>{console.error("Error al obtener los leads:",e)}))},leadAnterior(){this.currentIndex>0&&(this.currentIndex--,this.leadActual=this.leads[this.currentIndex])},leadSiguiente(){this.currentIndex<this.leads.length-1&&(this.currentIndex++,this.leadActual=this.leads[this.currentIndex])},habilitarEdicion(){this.editMode=!0},guardarCambios(){const e=localStorage.getItem("id_usuario");if(!e)return alert("Error: Sesión no válida. Por favor, inicia sesión nuevamente."),void this.$router.push("/");le.A.post("/update-lead",{...this.leadActual,usuario_id:e}).then((()=>{alert("Cambios guardados exitosamente"),this.editMode=!1,this.consultarLeads()})).catch((e=>{console.error("Error al guardar los cambios:",e.response?e.response.data:e),alert("No se pudo guardar el lead.")}))},nuevoLead(){this.leadActual={nombres:"",apellidos:"",identificacion:"",telefono:"",direccion:"",ciudad:"",correo:"",fecha_lead:(new Date).toISOString().split("T")[0],origen_lead:"",marca_interes:"",modelo_interesado:"",estatus:"",asignado:!1,habeas_data:"No"},this.editMode=!0},seleccionarArchivo(e){this.archivo=e.target.files[0]},async validarArchivoAntesDeEnviar(){if(!this.archivo)return alert("Por favor, seleccione un archivo antes de cargar."),!1;const e=await this.leerArchivo(this.archivo),a=e.split("\n").map((e=>e.trim())),l=a[0].split(";").map((e=>e.trim().toLowerCase())),o=["nombres","apellidos","identificacion","telefono","direccion","ciudad","correo","fecha_lead","origen_lead","marca_interes","modelo_interesado","estatus","asignado","test_drive","habeas_data","aceptacion_tratamiento_datos"],t=o.filter((e=>!l.includes(e)));if(t.length>0)return alert(`El archivo no contiene los encabezados necesarios: ${t.join(", ")}. Verifique la plantilla.`),!1;for(let d=1;d<a.length;d++){if(!a[d])continue;const e=a[d].split(";").map((e=>e.trim())),o=e[l.indexOf("fecha_lead")];if(o&&!/^\d{4}-\d{2}-\d{2}$/.test(o))return alert(`Error en la fila ${d+1}: La fecha '${o}' no es válida. Use el formato AAAA-MM-DD.`),!1}return!0},leerArchivo(e){return new Promise(((a,l)=>{const o=new FileReader;o.onload=()=>a(o.result),o.onerror=e=>{console.error("Error leyendo el archivo:",e),alert("No se pudo leer el archivo. Verifique el formato y los permisos."),l(e)},o.readAsText(e,"utf-8")}))},async cargarLeadsDesdeArchivo(){const e=localStorage.getItem("id_usuario");if(!e)return alert("Sesión no válida. Por favor, inicia sesión nuevamente."),void this.$router.push("/");const a=await this.validarArchivoAntesDeEnviar();if(!a)return;const l=new FormData;l.append("file",this.archivo),l.append("usuario_id",e),le.A.post("/upload-leads",l).then((e=>{const{message:a,rechazos:l}=e.data,o=a.match(/Leads cargados: (\d+)/)[1],t=a.match(/Leads rechazados: (\d+)/)[1];alert(`Resumen de la carga de leads:\n- Leads cargados: ${o}\n- Leads rechazados: ${t}\n-- Rechazos por Habeas Data: ${l.habeas_data}\n-- Rechazos por Tratamiento de Datos: ${l.tratamiento_datos}`),this.consultarLeads()})).catch((e=>{e.response&&e.response.data.error?(alert(e.response.data.error),console.error("Error al cargar leads desde archivo:",e.response?e.response.data:e)):alert("Ocurrió un error al cargar el archivo. Intente nuevamente cargar los leads rechazados.")}))},descargarPlantilla(){const e=document.createElement("a");e.href="/static/leads_plantilla_de_cargue.csv",e.download="leads_plantilla_de_cargue.csv",e.click()}},components:{BotonesGlobales:oe.A}},de=l(1241);const se=(0,de.A)(te,[["render",ae],["__scopeId","data-v-222723ff"]]);var ie=se}}]);
//# sourceMappingURL=164.b019104f.js.map